---
import MobileMenu from './MobileMenu';
import SimpleLocaleSwitcher from './SimpleLocaleSwitcher';
import { getLocaleFromPath, getTranslations } from '../i18n';
import { getRegionFromLocale } from '../config/pricing';

const currentPath = Astro.url.pathname;
const locale = getLocaleFromPath(currentPath);
const region = getRegionFromLocale(locale);
const t = getTranslations(locale);
const currency = region === 'CH' ? 'CHF' : 'EUR';

// Helper to generate locale-aware links
function getLink(path: string) {
	if (locale === 'en') {
		return `/en${path}`;
	}
	return path;
}
---

<nav class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
		<div class="flex justify-between items-center h-16">
			<div class="flex items-center">
				<a href={getLink('/')} class="flex items-center space-x-2">
					<img src="/logo.svg" alt="formalogix Logo" class="h-8 w-auto" />
					<span class="text-xl font-bold text-gray-900">formalogix</span>
				</a>
			</div>
			<div class="hidden md:flex space-x-8 items-center">
				<a href={`${getLink('/')}#services`} class="text-gray-700 hover:text-formalogix-500 transition-colors">
					{t.nav.solutions}
				</a>

				<!-- Success Stories Dropdown -->
				<div class="relative group">
					<button class="text-gray-700 hover:text-formalogix-500 transition-colors flex items-center">
						{t.nav.successStories}
						<svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
						</svg>
					</button>
					<div class="absolute left-0 mt-2 w-56 bg-white rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
						<div class="py-2">
							<a href={`${getLink('/')}#usecases`} class="block px-4 py-2 text-gray-700 hover:bg-formalogix-50 hover:text-formalogix-600">
								{locale === 'de' ? 'Übersicht' : 'Overview'}
							</a>
							<div class="border-t border-gray-100 my-1"></div>
							<a href={getLink('/use-cases/gebaudeversicherung')} class="block px-4 py-2 text-gray-700 hover:bg-formalogix-50 hover:text-formalogix-600">
								{locale === 'de' ? 'Gebäudeversicherung' : 'Property Insurance'}
							</a>
							<a href={getLink('/use-cases/dsgvo-eventanmeldung')} class="block px-4 py-2 text-gray-700 hover:bg-formalogix-50 hover:text-formalogix-600">
								{locale === 'de' ? 'DSGVO-Eventanmeldung' : 'GDPR Event Registration'}
							</a>
							<a href={getLink('/use-cases/messegewinnspiel')} class="block px-4 py-2 text-gray-700 hover:bg-formalogix-50 hover:text-formalogix-600">
								{locale === 'de' ? 'Messegewinnspiel' : 'Trade Fair Raffle'}
							</a>
						</div>
					</div>
				</div>

				<a href={getLink('/pricing')} class="text-gray-700 hover:text-formalogix-500 transition-colors">
					{t.nav.pricing}
				</a>

			</div>
			<div class="flex items-center space-x-2">
				<!-- Language/Currency Switcher (Always Visible) -->
				<SimpleLocaleSwitcher initialLocale={locale} initialCurrency={currency} client:load />
				<a href={`${getLink('/')}#contact`} class="hidden sm:inline-block bg-formalogix-500 text-white px-4 py-2 rounded-lg hover:bg-formalogix-600 transition-colors">
					{t.nav.contact}
				</a>
				<MobileMenu initialLocale={locale} client:load />
			</div>
		</div>
	</div>
</nav>
